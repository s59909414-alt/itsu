<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æœ‰ä¸€å‰‡æ–°è¨Šæ¯...</title>
<meta property="og:type" content="website">
<meta property="og:url" content="https://s59909414-alt.github.io/itsu/">
<meta property="og:title" content="æœ‰ä¸€å‰‡æ–°è¨Šæ¯...">
<meta property="og:description" content="å¼µè»’æµ©å‚³é€äº†ä¸€å‰‡è¨Šæ¯çµ¦ä½ ï¼Œé»æ“ŠæŸ¥çœ‹å›æ†¶ã€‚">
<meta property="og:image" content="https://s59909414-alt.github.io/itsu/DSCF1829.jpg">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="æœ‰ä¸€å‰‡æ–°è¨Šæ¯...">
<meta name="twitter:description" content="å¼µè»’æµ©å‚³é€äº†ä¸€å‰‡è¨Šæ¯çµ¦ä½ ã€‚">
<meta name="twitter:image" content="https://s59909414-alt.github.io/itsu/DSCF1829.jpg">
<link rel="icon" href="instagram_logo.png" type="image/png">

<style>
  /* --- ğŸ¨ Theme Settings --- */
  :root {
    --glass-surface: rgba(255, 255, 255, 0.02);
    --glass-border: rgba(255, 255, 255, 0.15);
    --glass-blur: blur(12px);
    
    --bubble-me-bg: linear-gradient(135deg, rgba(168, 110, 122, 0.7), rgba(194, 142, 154, 0.8));
    --bubble-me-shadow: 0 4px 10px rgba(168, 110, 122, 0.2);
    --bubble-her-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
    --bubble-her-shadow: 0 4px 10px rgba(0,0,0,0.1);
    --ig-gradient: linear-gradient(135deg, #6558f5, #8a6efc);

    --text-primary: #ffffff;
    --text-secondary: rgba(255, 255, 255, 0.6);
    
    /* âš¡ï¸ å‹•ç•«æ ¸å¿ƒåƒæ•¸ */
    --anim-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
    --anim-smooth: cubic-bezier(0.4, 0, 0.2, 1);      
    --speed: 0.8s;
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  body {
    margin: 0; height: 100vh; overflow: hidden;
    background: #000;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex; justify-content: center; align-items: center;
    color: var(--text-primary);
  }

  /* --- ğŸŒŒ èƒŒæ™¯ --- */
  .aurora-bg {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: radial-gradient(circle at 50% 50%, #1a0b14 0%, #000000 100%);
    z-index: 0;
  }
  .blob {
    position: absolute; border-radius: 50%;
    filter: blur(90px); opacity: 0.4;
    animation: floatBlob 20s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
  }
  .blob-1 { top: 30%; left: 20%; width: 400px; height: 400px; background: #6b2c45; }
  .blob-2 { bottom: 20%; right: 20%; width: 350px; height: 350px; background: #1f2b5c; animation-delay: -5s; }
  @keyframes floatBlob {
    0% { transform: translate(0, 0) scale(1); }
    100% { transform: translate(-20px, 20px) scale(0.95); }
  }

  #starCanvas {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 1; opacity: 0.8; pointer-events: none;
  }

  /* --- ğŸ­ ä¸»èˆå° --- */
  #main-stage {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%; height: 100%;
    gap: 0px; 
    transition: gap var(--speed) var(--anim-smooth);
    z-index: 10;
  }

  #main-stage.mode-active {
    gap: 40px; 
  }

  /* --- ğŸ“± é€šç”¨é¢æ¿è¨­å®š --- */
  .glass-panel {
    height: auto; max-height: 85vh; 
    border-radius: 48px;
    background: var(--glass-surface);
    backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
    border: 1px solid var(--glass-border);
    box-shadow: 0 20px 80px rgba(0,0,0,0.5);
    overflow: hidden;
    position: relative;
    flex-shrink: 0; 
    
    width: 0; 
    opacity: 0;
    transform: scale(0.9);
    
    transition: 
      width var(--speed) var(--anim-smooth), 
      opacity var(--speed) var(--anim-smooth), 
      transform var(--speed) var(--anim-spring),
      border-width 0s linear 0.8s; 
      
    border-width: 0px; 
  }

  /* --- 1. å·¦å´ï¼šç…§ç‰‡å€ --- */
  #panel-photo {
    display: flex; justify-content: center; align-items: center;
    transform-origin: right center; 
  }
  
  #panel-photo.active {
    width: 350px; 
    opacity: 1; 
    transform: scale(1);
    border-width: 1px;
    transition: 
      width var(--speed) var(--anim-smooth), 
      opacity var(--speed) var(--anim-smooth), 
      transform var(--speed) var(--anim-spring),
      border-width 0s; 
  }

  .photo-img {
    width: 100%; height: 100%; object-fit: cover;
    transition: transform 5s;
  }
  #panel-photo.active .photo-img { transform: scale(1.1); }


  /* --- 2. ä¸­é–“ï¼šèŠå¤©å®¤ --- */
  #panel-chat {
    width: 414px; opacity: 1; transform: scale(1);
    display: flex; flex-direction: column; position: relative;
    aspect-ratio: 9 / 18;
    border-width: 1px; 
    z-index: 5; 
  }


  /* --- 3. å³å´ï¼šå¡ç‰‡å€ --- */
  #panel-card {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 30px; text-align: center;
    transform-origin: left center; 
  }

  #panel-card.active {
    width: 350px; 
    opacity: 1; 
    transform: scale(1);
    border-width: 1px;
    transition: 
      width var(--speed) var(--anim-smooth), 
      opacity var(--speed) var(--anim-smooth), 
      transform var(--speed) var(--anim-spring),
      border-width 0s;
  }

  .letter-content {
    opacity: 0; transform: translateY(20px);
    transition: all 0.5s var(--anim-smooth);
    width: 100%;
    display: flex; flex-direction: column; align-items: center;
  }
  #panel-card.active .letter-content {
    opacity: 1; transform: translateY(0);
    transition-delay: 0.4s; 
  }


  /* --- UI å…ƒä»¶ --- */
  .close-card-btn {
    position: absolute; top: 20px; right: 20px;
    width: 36px; height: 36px; border-radius: 50%;
    background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; z-index: 50; transition: 0.3s;
    opacity: 0; transform: scale(0);
  }
  #panel-card.active .close-card-btn { opacity: 1; transform: scale(1); transition-delay: 0.6s; }
  .close-card-btn:hover { background: rgba(255,255,255,0.2); transform: rotate(90deg); }
  .close-icon { font-size: 20px; color: white; line-height: 1; }

  /* Header */
  .header { height: 70px; display: flex; align-items: center; padding: 0 20px; border-bottom: 1px solid rgba(255,255,255,0.05); background: rgba(0, 0, 0, 0.05); z-index: 20; }
  .back-arrow { font-size: 24px; margin-right: 15px; cursor: pointer; opacity: 0.9; }
  .header-avatar { width: 38px; height: 38px; border-radius: 50%; background-image: url('me.jpg'); background-size: cover; margin-right: 15px; border: 1.5px solid rgba(255,255,255,0.5); flex-shrink: 0; }
  .header-name { font-weight: 600; font-size: 18px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .header-actions { margin-left: auto; display: flex; gap: 20px; opacity: 0.9; }

  /* Chat List */
  .chat-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; scroll-behavior: smooth; mask-image: linear-gradient(to bottom, transparent 0%, black 2%, black 98%, transparent 100%); }
  .chat-area::-webkit-scrollbar { display: none; }

  .date-stamp { text-align: center; color: var(--text-secondary); font-size: 12px; font-weight: 500; margin: 30px 0 15px 0; opacity: 0; animation: fadeIn 1.2s forwards; background: rgba(0,0,0,0.2); padding: 4px 12px; border-radius: 20px; align-self: center; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.05); }
  .message-row { display: flex; align-items: flex-end; margin-bottom: 16px; opacity: 0; transform: translateY(20px) scale(0.95); transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); justify-content: flex-start; }
  .message-row.show { opacity: 1; transform: translateY(0) scale(1); }
  .avatar-small { width: 32px; height: 32px; border-radius: 50%; background-image: url('me.jpg'); background-size: cover; margin-right: 12px; margin-bottom: 2px; flex-shrink: 0; border: 1px solid rgba(255,255,255,0.3); }
  .bubble { max-width: 78%; padding: 12px 16px; border-radius: 22px; font-size: 15px; line-height: 1.6; background: var(--bubble-me-bg); box-shadow: var(--bubble-me-shadow); color: white; border-bottom-left-radius: 4px; backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.1); }

  .ig-media-bubble { background: var(--ig-gradient); color: white; padding: 10px 18px 10px 14px; border-radius: 20px; border-bottom-left-radius: 4px; display: flex; align-items: center; gap: 10px; cursor: pointer; box-shadow: 0 5px 15px rgba(101, 88, 245, 0.4); transition: transform 0.2s; font-weight: 600; font-size: 15px; border: 1px solid rgba(255,255,255,0.2); }
  .ig-media-bubble:active { transform: scale(0.95); }
  .ig-icon-circle { width: 24px; height: 24px; border: 2px solid rgba(255,255,255,0.6); border-top: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
  .play-icon { font-size: 11px; line-height: 1; margin-left: 2px; }

  .typing-container { display: none; justify-content: flex-start; padding: 0 20px; margin-bottom: 15px; }
  .typing-bubble { background: var(--bubble-her-bg); box-shadow: var(--bubble-her-shadow); border: 1px solid rgba(255,255,255,0.15); padding: 12px 18px; border-radius: 22px; border-bottom-left-radius: 4px; display: flex; align-items: center; gap: 6px; backdrop-filter: blur(8px); }
  .dot { width: 6px; height: 6px; background-color: rgba(255,255,255,0.9); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
  .dot:nth-child(1) { animation-delay: -0.32s; } .dot:nth-child(2) { animation-delay: -0.16s; } 
  @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .footer { height: 80px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; padding: 0 20px 10px 20px; background: rgba(0,0,0,0.1); backdrop-filter: blur(15px); }
  .camera-btn { width: 40px; height: 40px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; margin-right: 15px; font-size: 18px; flex-shrink: 0; border: 1px solid rgba(255,255,255,0.2); }
  .input-bar { flex: 1; height: 40px; background: rgba(255,255,255,0.05); border-radius: 22px; display: flex; align-items: center; padding: 0 16px; color: rgba(255,255,255,0.6); font-size: 15px; border: 1px solid rgba(255,255,255,0.15); }

  #passwordLayer { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 50; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(25px); opacity: 0; transition: opacity 0.5s; }
  .lock-box { background: rgba(255,255,255,0.05); padding: 40px; border-radius: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.6), inset 0 0 0 1px rgba(255,255,255,0.2); text-align: center; width: 85%; max-width: 320px; backdrop-filter: blur(15px); }
  .shake { animation: shake 0.5s; }
  @keyframes shake { 0%,100% {transform:translateX(0);} 25% {transform:translateX(-10px);} 75% {transform:translateX(10px);} }

  .pwd-input { width: 100%; padding: 15px; margin: 25px 0; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); color: white; border-radius: 18px; font-size: 26px; text-align: center; outline: none; letter-spacing: 12px; transition: 0.3s; }
  .pwd-input:focus { border-color: rgba(194, 142, 154, 0.8); box-shadow: 0 0 20px rgba(168, 110, 122, 0.4); }
  
  .unlock-msg-btn, .unlock-btn { background: linear-gradient(135deg, rgba(168, 110, 122, 0.8), rgba(194, 142, 154, 0.8)); color: white; padding: 14px 30px; width: 100%; border-radius: 25px; font-weight: 600; font-size: 15px; border: none; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; box-shadow: 0 10px 30px rgba(168, 110, 122, 0.3), inset 0 1px 0 rgba(255,255,255,0.3); transition: all 0.3s; position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.2); }
  .unlock-msg-btn:hover, .unlock-btn:hover { transform: translateY(-2px); box-shadow: 0 15px 40px rgba(168, 110, 122, 0.5); }
  .message-row.system-row { justify-content: center; margin-top: 25px; width: 100%; }

  .card-photo { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; margin-bottom: 30px; box-shadow: 0 10px 50px rgba(168, 110, 122, 0.6); border: 4px solid rgba(255,255,255,0.9); }
  
  /* âœ¨âœ¨ ä¿®æ”¹è™•ï¼šè®“æ–‡å­—å€åŸŸå¯ä»¥æ²å‹• âœ¨âœ¨ */
  .final-msg { 
    font-family: 'Noto Serif TC', serif; 
    color: #fff; 
    line-height: 2.2; 
    font-size: 15px; 
    margin-top: 20px; 
    max-width: 320px; 
    text-shadow: 0 2px 15px rgba(0,0,0,0.8);
    
    /* æ²å‹•è¨­å®š */
    max-height: 300px;
    overflow-y: auto;
    padding-right: 10px;
    
    /* ç¾åŒ–æ²è»¸ */
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,0.4) transparent;
  }
  
  /* Webkit æ²è»¸æ¨£å¼ */
  .final-msg::-webkit-scrollbar { width: 4px; }
  .final-msg::-webkit-scrollbar-track { background: transparent; }
  .final-msg::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.4); border-radius: 10px; }

  /* --- ğŸš€ Performance / Smoothness --- */
  .glass-panel, .message-row, .blob, .photo-img, #starCanvas {
    will-change: transform, opacity;
    transform: translateZ(0);
  }
  .chat-area { -webkit-overflow-scrolling: touch; }

  @media (max-width: 800px) {
    #main-stage { flex-direction: column; }
    .glass-panel { width: 90% !important; max-width: 400px; }
    #panel-photo.active, #panel-card.active { height: 300px; }
  }

</style>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500&display=swap" rel="stylesheet">
</head>
<body>

<div class="aurora-bg">
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>
</div>

<canvas id="starCanvas"></canvas>

<div id="main-stage">
  
  <div class="glass-panel" id="panel-photo" onclick="closePhotoView()">
    <img src="20251011.jpg" class="photo-img" alt="Secret Photo">
  </div>

  <div class="glass-panel" id="panel-chat">
    <div class="header">
      <div class="back-arrow">â†</div>
      <div class="header-avatar"></div>
      <div><div class="header-name">å¼µè»’æµ©</div></div> 
      <div class="header-actions">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 20px;"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>
      </div>
    </div>

    <div class="chat-area" id="chatArea"></div>

    <div class="typing-container" id="typingContainer">
      <div class="avatar-small"></div>
      <div class="typing-bubble">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
      </div>
    </div>

    <div class="footer">
      <div class="camera-btn">ğŸ“·</div>
      <div class="input-bar">ç™¼é€è¨Šæ¯...</div>
    </div>

    <div id="passwordLayer">
      <div class="lock-box" id="lockBox">
        <div style="font-size: 40px; margin-bottom: 15px;">ğŸ”’</div>
        <h3 style="margin:0 0 10px; color:#fff; letter-spacing: 1px;">ç§å¯†å‚™å¿˜éŒ„</h3>
        <p style="color:#ccc; font-size:13px; margin-bottom: 0;">è¼¸å…¥å¯†ç¢¼è§£é–å›æ†¶</p>
        <input type="tel" id="pwdInput" class="pwd-input" maxlength="4" placeholder="â€¢â€¢â€¢â€¢">
        <button class="unlock-btn" onclick="checkPassword()">è§£é–</button>
      </div>
    </div>
  </div>

  <div class="glass-panel" id="panel-card">
    <div class="close-card-btn" onclick="closeCard()">
      <span class="close-icon">Ã—</span>
    </div>

    <div class="letter-content">
      <img src="DSCF1829.jpg" class="card-photo"> 
      <h1 style="color:#fff; font-size: 24px; margin: 0; text-shadow: 0 0 20px rgba(168, 110, 122, 0.8);">To:é„­ä¼å¦</h1>
      <div class="final-msg">
        å°æˆ‘ä¾†èªª<br>
        å¦³çœŸçš„å¾ˆç‰¹åˆ¥<br>
	ç‰¹åˆ¥çš„ç¨‹åº¦å°±å¥½æ¯”<br>
        ä¸æƒœèŠ±è²»ä¸€åˆ‡<br>
        ä¹Ÿè¦æ”¶å…¥å›Šä¸­çš„å¯¶ç‰©<br><br>

        è€Œä¸”æˆ‘å¾ä¾†æ²’æœ‰<br>
        ç‚ºäº†è¿½ä¸€å€‹å¥³ç”Ÿ<br>
        è²»ç›¡é€™éº¼å¤šå¿ƒæ€é<br><br>
        
        èªªå¯¦è©±<br>
        ä¸€é–‹å§‹åªæ˜¯è¢«å¦³çš„å¤–è¡¨å¸å¼•<br>
        ä¹Ÿè‘—è¿·å¦³é‚£çŒœä¸é€çš„ç¥ç§˜æ„Ÿ<br>
        ä½†éš¨è‘—å°å¦³çš„äº†è§£è¶Šä¾†è¶Šå¤š<br>
        å–œæ­¡çš„æ„Ÿè¦ºæ¼¸æ¼¸è®Šå¾—ç¨ç‰¹<br><br>

        å¦³éƒ½å•æˆ‘å–œæ­¡å¦³ä»€éº¼<br>
        æˆ‘å–œæ­¡<br>
	å¦³è·Ÿæˆ‘èŠå¤©æ™‚çš„å…±é³´<br>
        æˆ‘å–œæ­¡<br>
	èˆ‡å¦³ç›¸è™•æ™‚çš„è‡ªåœ¨<br>
	æˆ‘å–œæ­¡<br>
        å¦³ç¸½æ˜¯èƒ½å¤ çµ¦æˆ‘<br>
        å…¶ä»–äººçµ¦ä¸äº†çš„å¥‘åˆæ„Ÿ<br><br>

        æ„Ÿè¬å¦³é¡˜æ„çœ‹åˆ°é€™é‚Š<br>
        ä¸çŸ¥é“ä»Šå¤©çš„å‘Šç™½<br>
	å¦³è¦ºå¾—æ€éº¼æ¨£<br><br>

        é€™äº›æ–‡å­—ç„¡æ³•<br>
	å®Œæ•´åœ°è¡¨é”æˆ‘çš„å¿ƒæ„<br>
        é‚£äº›èªªä¸å‡ºå£çš„ç¨®ç¨®<br>
        ä»¥åŠå°å¦³èªªéçš„å…¨éƒ¨æ‰¿è«¾<br>
        æˆ‘éƒ½æœƒç”¨å¯¦éš›çš„è¡Œå‹•<br>
	åœ¨æœªä¾†å‘å¦³è­‰æ˜<br><br>

        æ‰€ä»¥<br>
        é„­ä¼å¦<br><br><br><br>
        å¦³é¡˜æ„<br>
        è·Ÿæˆ‘åœ¨ä¸€èµ·å—ï¼Ÿ<br>
      </div>
    </div>
  </div>

</div>

<script>
  /* ======================================================
     ğŸŒŒ æ··åˆç‰¹æ•ˆï¼šæ˜Ÿæ˜Ÿ + æµæ˜Ÿ + éš¨æ©Ÿæ„›èª
     ====================================================== */
  const canvas = document.getElementById('starCanvas');
  const ctx = canvas.getContext('2d');
  let width, height;
  let entities = []; 

  // å¤šåœ‹èªè¨€çš„ã€Œæ„›ã€
  const loveWords = [
      "Love", "æ„›", "Amor", "ì‚¬ë‘", "AÅŸk", "Liebe", "AimÃ©e", "Amore", "å¥½ã", 
      "Dashuri", "Liefde", "Cinta", "Ğ›ÑĞ±Ğ¾Ğ²ÑŒ", "Î‘Î³Î¬Ï€Î·", "Te amo"
  ];

  // ======================================================
  // ğŸŒŸ æ˜Ÿé»æ…¢æ…¢æ’å‡ºåœ–æ¡ˆï¼ˆä¸å½±éŸ¿èŠå¤©å…§å®¹ï¼‰
  // - å…ˆç¶­æŒä¸€èˆ¬æ˜Ÿç©ºæ¼‚æµ®
  // - éä¸€æ®µæ™‚é–“å¾Œï¼Œéƒ¨åˆ†æ˜Ÿé»æœƒé€æ­¥ã€Œé›†åˆã€æˆæ˜Ÿåº§ç¬¦è™Ÿï¼ˆé¡ä¼¼ä½ çµ¦çš„åœ–ï¼‰
  // ======================================================
  const CONSTELLATION = {
    startAfterMs: 7000,     // å¹¾ç§’å¾Œé–‹å§‹æ…¢æ…¢é›†åˆ
    buildDurationMs: 22000, // é›†åˆåˆ°ä½æ‰€éœ€æ™‚é–“
    holdMs: 12000,          // åœç•™ä¸€é™£å­
    releaseMs: 8000,        // å†æ…¢æ…¢æ•£å›å»
    starUseRatio: 0.55      // ç”¨å¤šå°‘æ¯”ä¾‹çš„æ˜Ÿæ˜Ÿå»æ’åœ–ï¼ˆé¿å…å¤ªæ“ /å¤ªé‡ï¼‰
  };
  let constellationTargets = [];
  let constellationStartAt = performance.now();
  let constellationPhase = 0; // 0 idle, 1 build, 2 hold, 3 release

  function clamp01(x){ return Math.max(0, Math.min(1, x)); }
  function easeInOutCubic(t){ return t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2, 3)/2; }

  // ç”Ÿæˆã€Œå·¨èŸ¹åº§ã€ç¬¦è™Ÿï¼ˆâ™‹ï¼‰é¢¨æ ¼çš„é»ä½ï¼šå…©å€‹æ¼©æ¸¦ + Så½¢é€£æ¥
  function buildCancerTargets(count) {
    // ä»¥ç•«é¢ä¸­å¿ƒç‚ºåŸºæº–çš„ç¸®æ”¾
    const cx = width * 0.52;
    const cy = height * 0.44;
    const scale = Math.min(width, height) * 0.23; // åœ–æ¡ˆå¤§å°

    const points = [];

    // å·¦ä¸Šæ¼©æ¸¦
    const c1x = cx - scale * 0.55;
    const c1y = cy - scale * 0.30;
    const r1  = scale * 0.28;

    // å³ä¸‹æ¼©æ¸¦
    const c2x = cx + scale * 0.55;
    const c2y = cy + scale * 0.30;
    const r2  = scale * 0.28;

    // å…©å€‹å°åœˆ + ä¸€æ®µ S å½¢é€£æ¥ç·š
    const circlePts = Math.floor(count * 0.55);
    const linkPts   = count - circlePts;

    const c1Pts = Math.floor(circlePts * 0.5);
    const c2Pts = circlePts - c1Pts;

    for (let i=0;i<c1Pts;i++){
      const a = (i / c1Pts) * Math.PI * 2;
      points.push({ x: c1x + Math.cos(a)*r1, y: c1y + Math.sin(a)*r1 });
    }
    for (let i=0;i<c2Pts;i++){
      const a = (i / c2Pts) * Math.PI * 2;
      points.push({ x: c2x + Math.cos(a)*r2, y: c2y + Math.sin(a)*r2 });
    }

    // S link: y = sin curve, x linear
    const x0 = c1x + r1 * 0.55;
    const x1 = c2x - r2 * 0.55;
    for (let i=0;i<linkPts;i++){
      const t = i/(linkPts-1 || 1);
      const x = x0 + (x1-x0)*t;
      const y = cy + Math.sin((t*2-1)*Math.PI/2) * (scale*0.22);
      points.push({ x, y });
    }

    // è®“é»åˆ†ä½ˆæ›´å‡å‹»ï¼šæ‰“äº‚
    for (let i = points.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [points[i], points[j]] = [points[j], points[i]];
    }
    return points;
  }

  function updateConstellationPhase() {
    const now = performance.now();
    const t = now - constellationStartAt;

    if (t < CONSTELLATION.startAfterMs) {
      constellationPhase = 0;
      return { progress: 0, mode: 'idle' };
    }

    const t2 = t - CONSTELLATION.startAfterMs;

    if (t2 < CONSTELLATION.buildDurationMs) {
      constellationPhase = 1;
      const p = easeInOutCubic(clamp01(t2 / CONSTELLATION.buildDurationMs));
      return { progress: p, mode: 'build' };
    }

    const t3 = t2 - CONSTELLATION.buildDurationMs;

    if (t3 < CONSTELLATION.holdMs) {
      constellationPhase = 2;
      return { progress: 1, mode: 'hold' };
    }

    const t4 = t3 - CONSTELLATION.holdMs;

    if (t4 < CONSTELLATION.releaseMs) {
      constellationPhase = 3;
      const p = 1 - easeInOutCubic(clamp01(t4 / CONSTELLATION.releaseMs));
      return { progress: p, mode: 'release' };
    }

    // é€±æœŸé‡ä¾†
    constellationStartAt = performance.now();
    constellationPhase = 0;
    return { progress: 0, mode: 'idle' };
  }


  function initCanvas() {
    // Use devicePixelRatio for crisper + smoother canvas while capping cost
    const dpr = Math.min(window.devicePixelRatio || 1, 1.5);
    width = window.innerWidth;
    height = window.innerHeight;

    canvas.width = Math.floor(width * dpr);
    canvas.height = Math.floor(height * dpr);
    canvas.style.width = width + 'px';
    canvas.style.height = height + 'px';

    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    createEntities();
  }

  // 1. æ˜Ÿæ˜Ÿ Class
  class Star {
    constructor() {

      this.type = 'star';
      this.x = Math.random() * width; this.y = Math.random() * height; 
      this.size = Math.random() * 2;
      this.alpha = Math.random(); 
      this.speedX = (Math.random() - 0.5) * 0.2;
      this.speedY = (Math.random() - 0.5) * 0.2;
      // constellation
      this.tx = null; this.ty = null;
      this.homeX = this.x; this.homeY = this.y;
    }
    draw() {

      ctx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;
      ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
    }
    update(attract = 0) {
      // åŸæœ¬æ¼‚æµ®
      this.x += this.speedX; this.y += this.speedY;
      if(this.x < 0) this.x = width; if(this.x > width) this.x = 0;
      if(this.y < 0) this.y = height; if(this.y > height) this.y = 0;
      this.alpha += (Math.random() - 0.5) * 0.05;
      if(this.alpha < 0.3) this.alpha = 0.3; if(this.alpha > 1) this.alpha = 1;

      // é€æ­¥é›†åˆåˆ°åœ–æ¡ˆï¼šattract 0~1
      if (attract > 0 && this.tx !== null && this.ty !== null) {
        const strength = 0.018 + attract * 0.05;
        this.x += (this.tx - this.x) * strength;
        this.y += (this.ty - this.y) * strength;
      }
      // é‡‹æ”¾å›åŸæœ¬æ˜Ÿç©ºåˆ†å¸ƒï¼šattract è¶Šå°è¶Šå› home
      if (attract <= 0.001 && this.homeX !== null) {
        this.x += (this.homeX - this.x) * 0.002;
        this.y += (this.homeY - this.y) * 0.002;
      }
    }
  }

  // 2. æµæ˜Ÿ Class
  class Meteor {
    constructor() { this.type = 'meteor'; this.reset(); }
    reset() {
      this.x = Math.random() * width + 200; this.y = -100;
      this.speed = Math.random() * 5 + 10; this.len = Math.random() * 80 + 50; 
      this.angle = Math.PI / 4 + (Math.random() * 0.2); 
      this.opacity = 0; this.active = false;
      setTimeout(() => { this.active = true; this.opacity = 1; }, Math.random() * 8000);
    }
    draw() {
      if (!this.active) return;
      const gradient = ctx.createLinearGradient(this.x, this.y, this.x + this.len * Math.cos(this.angle), this.y - this.len * Math.sin(this.angle));
      gradient.addColorStop(0, `rgba(255,255,255,${this.opacity})`); gradient.addColorStop(1, 'rgba(255,255,255,0)');
      ctx.strokeStyle = gradient; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(this.x, this.y);
      ctx.lineTo(this.x - this.len * Math.cos(this.angle), this.y + this.len * Math.sin(this.angle)); ctx.stroke();
    }
    update() {
      if (!this.active) return; this.x -= this.speed * Math.cos(this.angle); this.y += this.speed * Math.sin(this.angle);
      if (this.x < -100 || this.y > height + 100) { this.active = false; this.reset(); }
    }
  }

  // 3. æ„›èª Class
  class LoveWord {
    constructor() {
      this.type = 'word';
      this.reset();
    }
    reset() {
      this.text = loveWords[Math.floor(Math.random() * loveWords.length)];
      this.x = Math.random() * (width - 100) + 50;
      this.y = Math.random() * (height - 100) + 50;
      this.size = Math.random() * 14 + 12; 
      this.maxOpacity = Math.random() * 0.5 + 0.2; 
      this.fadeSpeed = Math.random() * 0.005 + 0.002;
      this.opacity = 0;
      this.state = 'in'; 
      this.stayTime = Math.random() * 200 + 100;
      this.timer = 0;
    }
    draw() {
      ctx.font = `${this.size}px 'Noto Serif TC', serif`;
      ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
      ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
      ctx.fillText(this.text, this.x, this.y);
    }
    update() {
      if (this.state === 'in') {
        this.opacity += this.fadeSpeed;
        if (this.opacity >= this.maxOpacity) this.state = 'stay';
      } else if (this.state === 'stay') {
        this.timer++;
        if (this.timer >= this.stayTime) this.state = 'out';
      } else if (this.state === 'out') {
        this.opacity -= this.fadeSpeed;
        if (this.opacity <= 0) this.reset();
      }
    }
  }

  function createEntities() {
    entities = [];
    const starCount = Math.min(Math.floor((width * height) / 7500), 220);
    for (let i = 0; i < starCount; i++) entities.push(new Star());

    // Keep a few meteors + words, but avoid overdraw on smaller screens
    const meteorCount = width < 700 ? 2 : 3;
    const wordCount = width < 700 ? 6 : 8;
    for (let i = 0; i < meteorCount; i++) entities.push(new Meteor());
    for (let i = 0; i < wordCount; i++) entities.push(new LoveWord());
  }

  function animate() {
    ctx.clearRect(0, 0, width, height);
    const { progress } = updateConstellationPhase();
    entities.forEach(e => {
      if (e.type === 'star') e.update(progress);
      else e.update();
      e.draw();
    });
    requestAnimationFrame(animate);
  }

  window.addEventListener('resize', initCanvas);
  initCanvas();
  animate();


  /* ======================================================
     ğŸ’¬ åŠ‡æœ¬ (å·²é‚„åŸä½ çš„æ–‡å­—ï¼Œä¸¦ä¿®æ­£åœ–ç‰‡æ ¼å¼)
     ====================================================== */
  const script = [
    { type: 'date', text: '2026å¹´ 2æœˆ 8æ—¥' },
    { type: 'msg',  text: 'é¦–å…ˆå‘¢' },
    { type: 'msg',  text: 'æˆ‘æƒ³è·Ÿå¦³èªªè²æŠ±æ­‰' },
    { type: 'msg',  text: 'ç¾åœ¨çš„æˆ‘ æ²’è¾¦æ³•æ‹¿è‘—é®®èŠ±æµªæ¼«åœ°è·Ÿå¦³å‘Šç™½' },
    { type: 'msg',  text: 'æˆ‘æƒ³äº†å¥½ä¹… åˆ°åº•è©²æ€éº¼åš' },
    { type: 'msg',  text: 'æ‰ä¸æœƒè®“å¦³è¦ºå¾—éš¨ä¾¿' },
    { type: 'msg',  text: 'æ‰ä¸æœƒè®“å¦³æ„Ÿåˆ°å¤±æœ›' },
    { type: 'msg',  text: 'å…¶å¯¦é€™ä»¶äº‹æˆ‘å·²ç¶“åœ¨å¿ƒä¸­ç±Œå‚™å¥½ä¸€é™£å­' },
    { type: 'msg',  text: 'åªæ˜¯æ°¸é éƒ½é”ä¸åˆ°è‡ªå·±å¿ƒä¸­æ»¿æ„çš„æ¨£å­' },
    { type: 'msg',  text: 'è€Œä¸”' },
    { type: 'msg',  text: 'æ˜¨å¤©å¦³åœ¨é›»è©±è£¡èªªï¼šæˆ‘ä¸è¦ºå¾—åœ¨é€™éº¼çŸ­çš„æ™‚é–“å…§æ˜¯å¯ä»¥æº–å‚™å¾—æ€éº¼æ¨£' },
    { type: 'msg',  text: 'è½åˆ°çš„ç•¶ä¸‹å…¶å¯¦æœ‰é»å°èµ°å¿ƒ' },
    { type: 'msg',  text: 'å‘Šç™½é€™ä»¶äº‹ æˆ‘çœŸçš„æƒ¦è¨˜å¾ˆä¹…å¾ˆä¹…' },
    { type: 'msg',  text: 'ä¹Ÿä¸€ç›´æ”¾åœ¨å¿ƒä¸Š' },
    { type: 'msg',  text: 'æ‰€ä»¥ï¼Ÿ' },
    { type: 'msg',  text: 'å¦³æº–å‚™å¥½äº†å—ï¼Ÿ' },
    { type: 'msg',  text: '3' , extraDelay: 500 },
    { type: 'msg',  text: '2' , extraDelay: 500 },
    { type: 'msg',  text: '1' , extraDelay: 500 },

    { type: 'date', text: '2025å¹´ 7æœˆ 27æ—¥' },
    { type: 'msg',  text: 'å•Šå•Šå•Šå•Šå•Š' },
    { type: 'msg',  text: 'ä»Šå¤©è¢«é„­ä¼å¦å›é™å‹•äº†' },
    { type: 'msg',  text: 'æ˜¯æˆ‘å€‘ç¬¬ä¸€æ¬¡è¬›åˆ°è©±' },
    { type: 'msg',  text: 'å…¶å¯¦æ ¹æœ¬ä¹Ÿæ²’èŠåˆ°ä»€éº¼' },
    { type: 'msg',  text: 'ä½†é‚„æ˜¯å¥½é–‹å¿ƒ' },
    { type: 'msg',  text: 'ä»Šå¤©' },
    { type: 'msg',  text: 'æ˜¯å¼µè»’æµ©ç¢ºè¨ºç‚ºæšˆèˆ¹ä»”çš„ç¬¬ä¸€å¤©' },

    { type: 'date', text: '2025å¹´ 8æœˆ 16æ—¥' },
    { type: 'msg',  text: 'é€™å¤©èªªä¾†ä¹Ÿæ˜¯å¾ˆå¥‡æ€ª' },
    { type: 'msg',  text: 'åŠå¤œä¸‰é»çªç„¶è¢«å•èªªæœ‰æ²’æœ‰å‰ä»–' },
    { type: 'msg',  text: 'ç•¶ä¸‹å…¶å¯¦é€£æƒ³éƒ½æ²’æƒ³ å°±ç­”æ‡‰ä¸‹ä¾†äº†' },
    { type: 'msg',  text: 'åˆåœ¨å‰å¹¾å¤©åˆ·reelsçš„æ™‚å€™ç„¡æ„é–“çœ‹åˆ°å¦³æƒ³åƒæª¸æª¬å¡”' },
    { type: 'msg',  text: 'æˆ‘å°±è·‘å»googleå…¨å±æ±å¸‚çš„ç³•é»åº—' },
    { type: 'msg',  text: 'è¶…ç´šè¶…ç´šçŒ¶è±«è¦ä¸è¦è²·çµ¦å¦³' },
    { type: 'msg',  text: 'å¾ˆæ€•è‡ªå·±åšäº†ä»€éº¼è®“å¦³è¦ºå¾—å¤šé¤˜çš„äº‹' },
    { type: 'msg',  text: 'ç•¶æ™‚åªå¸Œæœ›å¦³çš„è¡¨æ¼”é †åˆ©' },
    { type: 'msg',  text: 'æƒ³å¿… é‚„æœ‰å¤¾é›œè‘—å°å¦³çš„ä¸€é»é»å–œæ­¡å§' },    
    { type: 'msg',  text: 'åæ­£å‘¢' },
    { type: 'msg',  text: 'æˆ‘ä»¥å¾Œé‚„æ˜¯æœƒç¹¼çºŒè²·æ›´å¤šå¥½åƒçš„æŠ•é¤µå¦³' },

    { type: 'date', text: '2025å¹´ 10æœˆ 11æ—¥' },
    { type: 'msg',  text: 'èªªåˆ°é€™å¤©å°±å¾ˆé–‹å¿ƒ' },
    { type: 'msg',  text: 'ä»Šå¤©æ˜¯æˆ‘å€‘ç¬¬ä¸€æ¬¡å‡ºé–€' },
    { type: 'msg',  text: 'å…ˆå»é§äºŒçœ‹å±•è¦½ åˆå»äº†æ——æ´¥' },
    { type: 'msg',  text: 'ä½†å…¶å¯¦åªè¦æ˜¯è·Ÿå¦³ä¸€èµ·' },
    { type: 'msg',  text: 'å»å“ªé‚Šå¥½åƒä¹Ÿä¸æ˜¯é‚£éº¼é‡è¦äº†' },
    { type: 'msg',  text: 'é‚„æœ‰é‚„æœ‰' },
    { type: 'msg',  text: 'åœ¨æ²™ç˜ä¸Šä¸€èµ·çœ‹çš„å¤•é™½' },
    { type: 'msg',  text: 'æˆ‘æœƒè¨˜å¾—å¾ˆä¹…å¾ˆä¹…' },
    { type: 'msg',  text: 'é€™æ˜¯é‚£å¤©å¦³å¹«æˆ‘æ‹çš„ç…§ç‰‡' },
    { type: 'photo', text: 'ç›¸ç‰‡', src: '20251011.jpg', extraDelay: 2000 }, 

    { type: 'date', text: '2025å¹´ 11æœˆ 30æ—¥' },
    { type: 'msg',  text: 'ä»Šå¤©æ™šä¸Š é„­ä¼å¦çªç„¶å°æˆ‘æ‰“äº†è¶…å¤šé é˜²é‡' },
    { type: 'msg',  text: 'å¥¹èªª è‡ªå·±ä¸æ˜¯å¾ˆèƒ½æ‰®å¥½å¥³æœ‹å‹çš„è§’è‰²' },
    { type: 'msg',  text: 'å¥¹èªª è‡ªå·±è¶…ä»»æ€§ ä¸è¬›ç† è„¾æ°£é‚„å¾ˆå·®' },
    { type: 'msg',  text: 'å¥¹èªª éœ€è¦ä¸€å€‹æƒ…ç·’ç©©å®šçš„äººæ‰èƒ½æ²»å¾—äº†å¥¹' },
    { type: 'msg',  text: 'ç¾åœ¨å›é ­çœ‹ æˆ‘æ ¹æœ¬å°±æ˜¯ä¸äºŒäººé¸' },
    { type: 'msg',  text: 'å¦³çœ‹ é€£æœˆè€éƒ½é€™éº¼è¦ºå¾—' },
    { type: 'photo', text: 'ç›¸ç‰‡', src: '20251130.jpg', extraDelay: 2000 }, 
    { type: 'msg',  text: 'è¢å¹•å‰é¢çš„å¦³ ä¹Ÿè¦é»é ­èªªå°å–”ğŸ«µğŸ»', extraDelay: 1000 },
  
    { type: 'date', text: '2025å¹´ 12æœˆ 25æ—¥' },
    { type: 'msg',  text: 'æ¬¸æˆ‘è·Ÿå¦³èªª å…¶å¯¦æˆ‘ä¸€åº¦ä»¥ç‚º' },
    { type: 'msg',  text: 'æˆ‘å€‘è–èª•ç¯€å‡ºé–€çš„äº‹è¦æ³¡æ¹¯äº†' },
    { type: 'msg',  text: 'å› ç‚ºç¬¬ä¸€æ¬¡å•å¦³çš„æ™‚å€™ å¦³èªªè¦ä¸Šç­' },
    { type: 'msg',  text: 'æˆ‘ç›´æ¥ä¸€æ•´å€‹è¶…é›£é' },
    { type: 'msg',  text: 'çµæœ çµæœ å¦³åˆçªç„¶æ‰¾æˆ‘å‡ºé–€äº†' },
    { type: 'msg',  text: 'è·Ÿå¦³ç›¸è™•çš„æ™‚å€™ å¿ƒæ€æ•´å€‹éƒ½åœ¨å¦³èº«ä¸Š' },
    { type: 'msg',  text: 'å¦³ç”¨å¿ƒæŠ•å…¥åœ¨æŸä¸€ä»¶äº‹æƒ…ä¸Šçš„æ™‚å€™' },
    { type: 'msg',  text: 'å°æˆ‘ä¾†èªªçœŸçš„è¶…ç´šæœ‰å¸å¼•åŠ›' },
    { type: 'msg',  text: 'å›å®¶ä¹‹å¾Œ é‚„çœ‹åˆ°å¦³å¯«çµ¦æˆ‘çš„å°ç´™æ¢' },
    { type: 'msg',  text: 'é›–ç„¶åªæœ‰äº”å€‹å­— ä½†è®“æˆ‘é–‹å¿ƒäº†ä¸€æ•´å€‹æ™šä¸Š' },
    { type: 'photo', text: 'ç›¸ç‰‡', src: '20251225_1.JPG' },
    { type: 'msg',  text: 'ç„¶å¾Œé€™æ˜¯å°‘æ•¸æœ‰å¦³èº«å½±çš„ç…§ç‰‡' },
    { type: 'photo', text: 'ç›¸ç‰‡', src: '20251225_2.jpg' },
    { type: 'msg',  text: 'é‚£æ™‚å€™å°æ–¼è¦è·Ÿå¦³ä¸€èµ·æ‹ç…§ çœŸçš„å¤ªææ‡¼äº†' },
    { type: 'msg',  text: 'é‚„æ˜¯èªª å…¶å¯¦é€™å€‹æ˜¯å®³ç¾' },

    { type: 'date', text: '2025å¹´ 12æœˆ 28æ—¥' },
    { type: 'msg',  text: 'è‡³æ–¼ä»Šå¤©å˜› å°±èªªä¸ä¸Šé–‹å¿ƒäº†' },
    { type: 'msg',  text: 'å¥½åƒæ˜¯æˆ‘æç ¸ä¸€åˆ‡çš„é–‹å§‹' },
    { type: 'msg',  text: 'ç¾åœ¨å›æƒ³é€™å¤©ç™¼ç”Ÿçš„äº‹ é‚„æ˜¯æœƒè¢«è‡ªå·±æ°£åˆ°' },
    { type: 'msg',  text: 'ä»¥å¾Œæˆ‘æœƒåŠªåŠ›ä¸è®“é€™ç¨®äº‹æƒ…ç™¼ç”Ÿçš„' },
    { type: 'msg',  text: 'é‚„æ˜¯ä»£è¡¨é‚£ä¸€å¤©çš„å¼µè»’æµ© è·Ÿå¦³èªªè²ä¸å¥½æ„æ€' },

    { type: 'date', text: '2026å¹´ 1æœˆ 3æ—¥' },
    { type: 'msg',  text: 'ä»Šå¤©å¾å°å—è¶•å›å±æ±' },
    { type: 'msg',  text: 'æ»¿å¿ƒæœŸå¾…è¦è·Ÿå¦³æ‹¿ç”Ÿæ—¥å¡ç‰‡' },
    { type: 'msg',  text: 'ä½†ç­‰ä¾†çš„ è·Ÿæƒ³åƒä¸­æœ‰å¥½å¤§çš„è½å·®' },
    { type: 'msg',  text: 'å¾å¦³æŠŠå¡ç‰‡éçµ¦æˆ‘çš„æ™‚å€™ æˆ‘å°±çŸ¥é“èªªå®Œè›‹äº†' },
    { type: 'msg',  text: 'æˆ‘çœŸçš„ä»¥ç‚º æˆ‘å€‘æœƒè€æ­»ä¸ç›¸å¾€ä¾†' },
    { type: 'msg',  text: 'æ²’æƒ³åˆ°......' },

    { type: 'date', text: '2026å¹´ 1æœˆ 23æ—¥' },
    { type: 'msg',  text: 'å»å±æ±çš„è·¯ä¸Š' },
    { type: 'msg',  text: 'æˆ‘' },
    { type: 'msg',  text: 'è»Šç¦äº†' },
    { type: 'msg',  text: 'çµæœåˆ°æ€¥è¨ºå®¤ æˆ‘ç¬¬ä¸€å€‹æƒ³åˆ°çš„äººæ˜¯å¦³' },
    { type: 'msg',  text: 'å†ä¸‰æ€è€ƒ é‚„æ˜¯æ±ºå®šè¦æŠŠé€™ä»¶äº‹å‘Šè¨´å¦³' },
    { type: 'msg',  text: '/silent' },
    { type: 'msg',  text: 'ä½†å¥½åƒä¹Ÿæ˜¯å› ç‚ºé€™æ¨£' },
    { type: 'msg',  text: 'æ•´ä»¶äº‹é–‹å§‹æœ‰äº†è®ŠåŒ–' },
    { type: 'msg',  text: 'çœŸçš„å¾ˆè¬è¬å¦³ åœ¨æˆ‘ä½é™¢çš„æ™‚å€™ä¾†æ¢æœ›æˆ‘' },
    { type: 'msg',  text: 'é‚„ç•™çµ¦æˆ‘å°ç´™æ¢è·Ÿè¶…å¥½åƒçš„é¤…ä¹¾' },
    { type: 'photo', text: 'ç›¸ç‰‡', src: '20260123.png' },

    { type: 'date', text: '2026å¹´ 1æœˆ 29æ—¥' },
    { type: 'msg',  text: 'é‚£å¦‚æœæ­¤æ™‚æ­¤åˆ»æˆ‘é‚„å¾ˆæ¸…æ™°çŸ¥é“è‡ªå·±å–œæ­¡å¦³ æ‰‹è£¡é¢é‚„æ¡è‘—é‚£å€‹å–œæ­¡ èƒ½ä¸èƒ½å†è®“æˆ‘ç¹¼çºŒæœå¦³é‚é€² æˆ‘ä¹Ÿä¸çŸ¥é“è‡ªå·±ç‚ºä»€éº¼å¯ä»¥æé€™å€‹é›¢è­œçš„è¦æ±‚ ä½†æˆ‘å°±æ˜¯è¦ºå¾—è‡ªå·±é‚„æ˜¯å¾ˆå–œæ­¡å¦³' },
    { type: 'msg',  text: 'æˆ‘çœŸçš„èŠ±äº†å¥½å¤§çš„å‹‡æ°£æ‰æŒ‰ä¸‹ç™¼é€' },
    { type: 'msg',  text: 'è¶…ç´šæ€•å¦³æœƒè·Ÿæˆ‘èªªä¸è¦' },
    { type: 'msg',  text: 'çœŸçš„å¾ˆè¬è¬å¦³é¡˜æ„æŠŠé‚£äº›å¦³åœ¨æ„çš„é»éƒ½å‘Šè¨´æˆ‘' },
    { type: 'msg',  text: 'ä¹Ÿè¬è¬å¦³é¡˜æ„å†è€ƒæ…®æˆ‘ä¸€æ¬¡' },
    { type: 'msg',  text: 'æˆ‘ä¸€å®šæœƒå¥½å¥½æŠŠæ¡ä¸”å¥®ä¸é¡§èº«åœ°èµ°å‘å¦³' },

    { type: 'date', text: '2026å¹´ 1æœˆ 31æ—¥' },
    { type: 'msg',  text: 'ä»Šå¤©è§£æ±ºäº†ä¸€å€‹å¤§å±æ©Ÿ' },
    { type: 'msg',  text: 'æˆ‘éƒ½ä½©æœè‡ªå·±äº† å¦³çŸ¥é“å—' },
    { type: 'msg',  text: 'æ ¹æœ¬å°±æ˜¯æ‹†é™¤äº†ä¸€é¡†é«˜é›£åº¦çš„æœªçˆ†å½ˆ' },
    { type: 'msg',  text: 'ç•¶ä¸‹çœŸçš„è¶…ä¸çŸ¥æ‰€æª' },
    { type: 'msg',  text: 'é‚„è¨˜å¾—å— æˆ‘èªªéï¼š' },
    { type: 'msg',  text: 'ä¸‹ä¸€æ¬¡ ä¸‹ä¸‹ä¸€æ¬¡ ä¸‹ä¸‹ä¸‹ä¸€æ¬¡ å¥½å¹¾å€‹ä¸‹ä¸€æ¬¡ éƒ½ä¸æœƒè¨å­å¦³ éƒ½ä¸æœƒå°å¦³å°è±¡ä¸å¥½ æˆ‘æœƒåŠªåŠ›è·Ÿä»Šå¤©ä¸€æ¨£ ç­‰åˆ°å¦³æœ€æƒ³å‘Šè¨´æˆ‘çš„è©±' },
    { type: 'msg',  text: 'æˆ‘ä¿è­‰ æˆ‘ä¸€å®šæœƒåšåˆ°' },
    { type: 'msg',  text: 'æˆ‘ä¸æœƒè¢«å¦³æ¨é–‹ æ›´ä¸æœƒæŠŠå¦³æ™¾åœ¨ä¸€æ—' },
    { type: 'msg',  text: 'æƒ…ç·’éƒ½æœƒè·Ÿä»Šå¤©ä¸€æ¨£ç©©å®š ä¹Ÿæœƒå¥½å¥½é™ªè‘—å¦³' },
    { type: 'msg',  text: 'æ‰€ä»¥ æ‹œè¨—å¦³ç›¸ä¿¡æˆ‘' },

    { type: 'date', text: 'ç¾åœ¨' },
    { type: 'msg',  text: 'ä¸çŸ¥é“å¦³è¦ºå¾—å¤ ä¸å¤ ç”¨å¿ƒ' },
    { type: 'msg',  text: 'å¸Œæœ›å¦³ä¸æœƒå¤±æœ›' },
    { type: 'msg',  text: 'æˆ‘ä¿è­‰ æ¼‚æ¼‚äº®äº®çš„èŠ± æˆ‘ä¹‹å¾Œä¸€å®šæœƒè£œçµ¦å¦³', extraDelay: 500 },
  ];

  const PASSWORD = "0206";
  const chatArea = document.getElementById('chatArea');
  const typingContainer = document.getElementById('typingContainer');
  let step = 0;
  let isUnlocked = false; 

  const CONFIG = {
    // è®“ã€Œæ­£åœ¨è¼¸å…¥ã€æ›´åƒçœŸäººï¼šæ‰“å­—æ›´ä¹…ã€é–±è®€åœç•™æ›´ä¹…ï¼ˆä¸æ”¹ä»»ä½•æ–‡å­—å…§å®¹ï¼‰
    baseTyping: 900,
    perCharTyping: 120,
    baseRead: 1400,
    perCharRead: 140,
    // ä¸Šä¸‹é™é¿å…å¤ªèª‡å¼µæˆ–å¤ªçŸ­
    minTyping: 900,
    maxTyping: 9000,
    minRead: 1200,
    maxRead: 12000
  };

  function calculateTiming(text) {
    const len = text ? text.length : 0;

    let typingTime = CONFIG.baseTyping + (len * CONFIG.perCharTyping);
    let readTime = CONFIG.baseRead + (len * CONFIG.perCharRead);

    // clamp
    typingTime = Math.max(CONFIG.minTyping, Math.min(CONFIG.maxTyping, typingTime));
    readTime = Math.max(CONFIG.minRead, Math.min(CONFIG.maxRead, readTime));

    return { typingTime, readTime };
  }

  function runScript() {
    if (step >= script.length) { setTimeout(() => { addUnlockButton(); }, 520); return; }
    const item = script[step];
    
    if (item.type === 'date') {
      addDateStamp(item.text); step++; setTimeout(runScript, 520); 
    } 
    else if (item.type === 'msg') {
      const timing = calculateTiming(item.text);
      const finalTypingTime = item.typingTime || timing.typingTime;
      const finalReadTime = (item.readTime || timing.readTime) + (item.extraDelay || 0);
      showTyping();
      setTimeout(() => {
        hideTyping(); addMessage(item.text);
        setTimeout(() => { step++; runScript(); }, finalReadTime);
      }, finalTypingTime);
    }
    else if (item.type === 'photo') {
      showTyping();
      setTimeout(() => {
        hideTyping(); addPhotoBubble(item.text, item.src);
        setTimeout(() => { step++; runScript(); }, (item.extraDelay || 2600)); 
      }, 1500);
    }
  }

  function addDateStamp(text) {
    const div = document.createElement('div');
    div.className = 'date-stamp'; div.innerText = text;
    chatArea.appendChild(div); scrollToBottom();
  }

  function addMessage(text) {
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message-row';
    msgDiv.innerHTML = `<div class="avatar-small"></div><div class="bubble">${text}</div>`;
    chatArea.appendChild(msgDiv);
    requestAnimationFrame(() => msgDiv.classList.add('show'));
    scrollToBottom();
  }

  function addPhotoBubble(text, imgSrc) {
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message-row';
    msgDiv.innerHTML = `
      <div class="avatar-small"></div>
      <div class="ig-media-bubble" onclick="togglePhotoView('${imgSrc}')">
        <div class="ig-icon-circle"><span class="play-icon">â–¶</span></div>
        ${text}
      </div>
    `;
    chatArea.appendChild(msgDiv);
    requestAnimationFrame(() => msgDiv.classList.add('show'));
    scrollToBottom();
  }

  function togglePhotoView(imgSrc) {
    const stage = document.getElementById('main-stage');
    const photoPanel = document.getElementById('panel-photo');
    const photoImg = document.querySelector('.photo-img');
    const cardPanel = document.getElementById('panel-card');

    if (cardPanel.classList.contains('active')) {
      closeCard();
      setTimeout(() => {
        if (imgSrc) photoImg.src = imgSrc;
        stage.classList.add('mode-active');
        photoPanel.classList.add('active');
      }, 800); 
      return;
    }

    if (imgSrc) photoImg.src = imgSrc;

    const isActive = photoPanel.classList.contains('active');
    
    if (isActive && (!imgSrc || photoImg.src.includes(imgSrc))) {
      closePhotoView();
    } else {
      stage.classList.add('mode-active');
      photoPanel.classList.add('active');
    }
  }

  function closePhotoView() {
    const stage = document.getElementById('main-stage');
    const photoPanel = document.getElementById('panel-photo');
    
    photoPanel.classList.remove('active');
    setTimeout(() => {
      if (!document.querySelector('.glass-panel.active')) {
        stage.classList.remove('mode-active');
      }
    }, 800);
  }

  function closeCard() {
    const stage = document.getElementById('main-stage');
    const cardPanel = document.getElementById('panel-card');
    
    cardPanel.classList.remove('active');
    setTimeout(() => {
      if (!document.querySelector('.glass-panel.active')) {
        stage.classList.remove('mode-active');
      }
    }, 800);
  }

  function addUnlockButton() {
    const btnContainer = document.createElement('div');
    btnContainer.className = 'message-row system-row show';
    btnContainer.innerHTML = `
      <div class="unlock-msg-btn" onclick="showLockScreen()">
        è«‹å¦³æ”¶ä¸‹é€™å€‹ ğŸ’Œ 
      </div>
    `;
    chatArea.appendChild(btnContainer);
    scrollToBottom();
  }

  function showLockScreen() {
    if (isUnlocked) {
      const photoPanel = document.getElementById('panel-photo');
      if (photoPanel.classList.contains('active')) {
        closePhotoView();
        setTimeout(() => {
          const stage = document.getElementById('main-stage');
          const cardPanel = document.getElementById('panel-card');
          stage.classList.add('mode-active');
          cardPanel.classList.add('active');
        }, 800);
      } else {
        const stage = document.getElementById('main-stage');
        const cardPanel = document.getElementById('panel-card');
        stage.classList.add('mode-active');
        cardPanel.classList.add('active');
      }
      return;
    }
    const lockScreen = document.getElementById('passwordLayer');
    lockScreen.style.display = 'flex';
    setTimeout(() => { lockScreen.style.opacity = '1'; document.getElementById('pwdInput').focus(); }, 50);
  }

  function showTyping() { typingContainer.style.display = 'flex'; scrollToBottom(); }
  function hideTyping() { typingContainer.style.display = 'none'; }
  function scrollToBottom() {
    // Smooth + reliable autoscroll after DOM updates
    requestAnimationFrame(() => {
      const prefersReduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const top = chatArea.scrollHeight;
      try {
        chatArea.scrollTo({ top, behavior: prefersReduce ? 'auto' : 'smooth' });
      } catch (e) {
        chatArea.scrollTop = top;
      }
    });
  }

  function checkPassword() {
    const input = document.getElementById('pwdInput');
    const lockBox = document.getElementById('lockBox');
    const passwordLayer = document.getElementById('passwordLayer');
    const stage = document.getElementById('main-stage');
    const cardPanel = document.getElementById('panel-card');
    const photoPanel = document.getElementById('panel-photo');

    if (input.value === PASSWORD) {
      isUnlocked = true;
      passwordLayer.style.opacity = '0';
      setTimeout(() => { passwordLayer.style.display = 'none'; }, 500);
      
      if (photoPanel.classList.contains('active')) {
        closePhotoView();
        setTimeout(() => {
          stage.classList.add('mode-active');
          cardPanel.classList.add('active');
        }, 800); 
      } else {
        stage.classList.add('mode-active');
        cardPanel.classList.add('active');
      }
      
    } else {
      lockBox.classList.add('shake');
      input.value = ''; input.placeholder = "å¯†ç¢¼éŒ¯èª¤";
      setTimeout(() => lockBox.classList.remove('shake'), 500);
    }
  }

  setTimeout(runScript, 1000);

</script>
</body>
</html>
